メモ

・商品一覧ページはアプリとシステムで同一のものを使用すればよいか？

・つまり、フロント → springboot → cloudflare R2 で画像をアップロード
　それと同時にspringboot → データベース で画像のURL(ファイル名？)を保存
　データベース → springboot → フロント で画像URLを渡し、
　フロント側で <img src=画像URL> とすれば、表示できるはず。

　ProductControllerに渡されたFormクラスをそのままServiceに渡し、
　Serviceがエンティティへの変換、R2へのアップロード、
　URLの加工、データベースへの保存を行うようにし、
　実際にデータベースに登録できるか確かめるところから

　flywayのマイグレーションユーザは先にデータベース側で作成しておき、
　権限を与える必要がありそう。
　grant create, alter, drop, insert on ecsite to 'ユーザ名'@'ホスト'
　flyway_schema_history を参照するので、SELECT, LOCK TABLES も必要だった。

　springbootを実行してflywayでテーブルが作成されるか確認する
　無事flywayでテーブルを作成することができた。

======================================================================

　せっかくrest apiを使用しているので、複数企業がバックのサービスを
　使えるようにしたい。顧客企業テーブルも作成して、全ての情報に
　顧客企業IDを付加すれば実現できるか？

　R2はプレフィックスで階層を表現できるため、商品のジャンルごとに
　バケットを分ける必要はなく、階層で表現すればよい。
　そうすれば、データベースからgenreを取得してその文字列をそのまま
　取得したい階層に指定することができる。

======================================================================

マークダウンのテーブル便利な拡張機能
https://qiita.com/tawara_/items/5d59cf725e7c7aa72f0f

springbootでは multipart/form-data で送信されたそれぞれの情報を
@RequestPart("名前")で取得することができる。
https://b1san-blog.com/post/spring/spring-file/

aws-java-sdkをそのまま依存関係に追加すると、
ライブラリ全体をインクルードするため、かなりの量の不要なファイルも
取り込むことになってしまう。
aws-java-sdkは1.9.0以降、機能ごとにライブラリを取り込みできるため
そのようにした方が良い。
https://qiita.com/s-katsumata/items/34a326f1d802add10119

@ConfigurationPropertyがつけられたクラスをSpringDIに認識させる3つの方法
@EnableConfigurationPropertiesは記述が簡単だが、
@Beanで管理すると、@Beanメソッドを定義する際にprefixを上書きすることができ、
「同じ構造の異なるprefixを持つプロパティ」を1つのクラスで読み込むことができる。
https://qiita.com/cfg17771855/items/905da3100ae99c5197f0

MySQL8.0以降でユーザに権限を与える場合、ユーザ作成と権限付与は
別々に行わなければならないらしい？
https://www.grimoire.tokyo/2022/04/14/post-252/
https://qiita.com/Atsulabo/items/7512cdc267d89307995d

新たにMYSQL_DATABASEを指定したが、データベースが作られない。
　→ MySQLのdocker公式イメージは、ボリュームが空の状態の時だけ
　　初期化スクリプトを実行し、MYSQL_DATABASE,MYSQL_USERなどを作成する。
　　そのため、ボリュームを削除して再度upしなければならない。

docker compose down は up コマンドと真逆のことをする。
つまり、up で作られうるもの(イメージ、コンテナ、ボリューム、ネットワーク)を
すべて削除する。
https://qiita.com/suin/items/19d65e191b96a0079417

javaで画像ファイルどうかはjavax.imageio.ImageIO#reqd(File)
メソッドで判定することができる。
https://blog.ricemountainer.net/posts/2017/453836237/

springbootからR2にアクセスするコードは以下参照
https://developers.cloudflare.com/r2/examples/aws/aws-sdk-java/